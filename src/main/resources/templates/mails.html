<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>OpenAI - Showcase</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>


<div class="even-row-color">

    <form method="get" action="/fetch">
        <button>Lade neue Mails</button>
    </form>

    <form method="post" action="/scan">
        <button>Alle Mails kategorisieren</button>
    </form>
</div>

<div class="container my-2">
    <h3>Liste der Emails</h3>
    <table style="width:80%" border="1"
           class="table table-striped table-responsive-md">
        <thead class="table-header">
        <tr>
            <th>Datum</th>
            <th>Kategorie</th>
            <th>Stimmung</th>
            <th>Absender</th>
            <th>Betreff</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="mail:${mailList}">
            <td th:text="${mail.timestamp}"></td>
            <td th:if="${mail.category} == null">
                <form th:action="@{/scan/{id}(id=${mail.id})}" method="post" id="categorize">
                    <button th:onclick="sendRequest(mail.id)">Kategorisieren</button>
                </form>
            </td>
            <td th:text="${mail.mood}"></td>
            <td th:text="${mail.from_person}"></td>
            <td th:text="${mail.sentiment}"></td>
        </tr>
        </tbody>
    </table>
</div>

<script th:inline="javascript">
    function sendRequest(mailId) {
        document.getElementById("categorize").addEventListener("submit", function(event) {
            // Prevent the default form submission behavior
            event.preventDefault();
            console.log(mailId)

            // Get the mailId from your desired source (e.g., input field, JavaScript variable, etc.)
            let id = mailId; // Replace with the actual mail ID value

            // Update the form's action attribute with the mailId
            let form = event.target;
            form.action = form.action.replace("{id}", id);

            // Submit the form
            form.submit();
        });
    }
</script>


</html>
